Project online_store {
  database_type: 'multi database'
  Note: 'Schema of each database'
}

Table customers {
  id int [primary key]
  name varchar
  active_cart_id int [note: 'user can have multiple carts and this is the active one']
  email varchar
}

Table orders_metadata {
  id int [primary key]
  customers_id int 
  purchase_date date 
  order_status_id int
  total_price float
  indexes {
    (customers_id, purchase_date) [note: 'allows for date pagination for each user']
  }
}

Table orders_products {
  order_id int [primary key]
  product_id int [primary key]
  color_id int [primary key]
  size_id int [primary key]
  unit_price float [note: 'includes sale reduction to allow easy order quantity edits without cancellation of order']
  quantity int

}

//could use enum instead
Table orders_statuses {
  id int [primary key]
  name varchar [note: 'processing, shipped etc']
  description varchar
}


Table users_carts {
  customers_id int [primary key]
  cart_id int [primary key]
  cart_name varchar
}

Table carts_products {
  id int [primary key]
  product_id int [primary key]
  color_id int [primary key]
  size_id int [primary key]
  quantity int

}

Table categories {
  id int [primary key]
  name varchar
}

//To make the tree building faster a well known sentinel root id should be used.
Table category_tree {
  parent_id int [primary key]
  child_id int [primary key]
}


Table products_metadata {
  id int [primary key]
  active bool [note: 'if false product is archived']
  name varchar
  description varchar
  main_category_id int
  sub1_category_id int
  sub2_category_id int
  sub3_category_id int
  default_price float [note: 'used if product"s color-size price excluded']
  date_added timestamp
  purchases int
  indexes {
    (active, main_category_id, sub1_category_id, sub2_category_id, sub3_category_id, default_price) //pagination by price
    (active, main_category_id, sub1_category_id, sub2_category_id, sub3_category_id, date_added) //pagination by new
    (active, main_category_id, sub1_category_id, sub2_category_id, sub3_category_id, purchases) //pagination by popularity
  }
}

Table products_group {
  product_id int [primary key, ref: - products_metadata.id]
  group_id int
  name varchar
  indexes {
    (group_id, product_id)
  }
}

Table groups {
  id int [primary key, ref: < products_group.group_id]
  name varchar
  description varchar
}

Table products_compositions {
  product_id int [primary key]
  material_id int [primary key]
  percent float
  decription varchar [note: 'optional, states where the material is located']
}

Table materials {
  id int [primary key]
  name varchar
  decription varchar
}

Table products {
  product_id int [primary key]
  color_id int [primary key]
  size_id int [primary key]
  price float
  sale_reduction float
  purchases int
  quantity int
}

Table brands {
  id int [primary key]
  name varchar
}

Table colors {
  id int [primary key]
  name varchar
  hex varchar
}


Table sizes {
  id int [primary key]
  size varchar
  description varchar
}

Table products_care_instructions {
  product_id int [primary key]
  care_instructions_id int [primary key]
  indexes {
    product_id
  }
}

Table care_instructions {
  id int [primary key]
  name varchar
  instruction varchar
}


Table products_brands {
  product_id int [primary key]
  brand_id int [primary key]
}

Table products_images {
  product_id int [primary key]
  color_id int [primary key]
  screen_size_id int [primary key]
  image_use_id int [primary key]  
  images blob

}

//can combine with products_image but must becareful for clashing ids
Table categories_images {
  category_id int [primary key]
  screen_size_id int [primary key]
  image_use_id int [primary key]
  image blob
}

//can combine with products_image but must becareful for clashing ids
Table brands_images {
  brand_id int [primary key]
  screen_size_id int [primary key]
  image_use_id int [primary key]
  image blob
}

Table screen_sizes {
  id int [primary key]
  name varchar
  description varchar
}


Table images_use {
  id int [primary key]
  name varchar
  description varchar
}




ref: customers.id < orders_metadata.customers_id
ref: customers.id < users_carts.customers_id
ref: customers.active_cart_id < carts_products.id
ref: customers.active_cart_id - users_carts.cart_id
ref: orders_metadata.id < orders_products.order_id
ref: categories.id < category_tree.parent_id
ref: categories.id < category_tree.child_id
ref: categories.id < products_metadata.main_category_id
ref: categories.id < products_metadata.sub1_category_id
ref: categories.id < products_metadata.sub2_category_id
ref: categories.id < products_metadata.sub3_category_id
ref: categories.id < categories_images.category_id
ref: carts_products.id > users_carts.cart_id
ref: products_metadata.id < orders_products.product_id
ref: products_metadata.id < carts_products.product_id
ref: products_metadata.id < products.product_id
ref: products_metadata.id < products_compositions.product_id
ref: products_metadata.id < products_care_instructions.product_id
ref: products_metadata.id < products_images.product_id
ref: products_metadata.id < products_brands.product_id
ref: colors.id < products.color_id
ref: colors.id < products_images.color_id
ref: colors.id < carts_products.color_id
ref: colors.id < orders_products.color_id
ref: sizes.id < carts_products.size_id
ref: sizes.id < orders_products.size_id
ref: sizes.id < products.size_id
ref: materials.id < products_compositions.material_id
ref: care_instructions.id < products_care_instructions.care_instructions_id
ref: brands.id < brands_images.brand_id
ref: brands.id < products_brands.brand_id
ref: screen_sizes.id < brands_images.screen_size_id
ref: screen_sizes.id < products_images.screen_size_id
ref: screen_sizes.id < categories_images.screen_size_id
ref: images_use.id < brands_images.image_use_id
ref: images_use.id < products_images.image_use_id
ref: images_use.id < categories_images.image_use_id
ref: orders_statuses.id < orders_metadata.order_status_id